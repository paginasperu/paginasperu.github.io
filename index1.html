<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Generador de Cat√°logo ¬∑ Exportar PDF (Demo)</title>
<meta name="description" content="Generador r√°pido de cat√°logos profesionales. A√±ade productos, elige plantilla y exporta PDF de alta calidad." />
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f6f8fb; --card:#fff; --accent:#0b76ef; --muted:#6b7280;
    --radius:12px; --maxw:1100px;
    --font-sans: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    --font-serif: "Playfair Display", Georgia, serif;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:var(--font-sans);background:linear-gradient(180deg,#fff,#f3f7fb);color:#0b1220;}
  .wrap{max-width:var(--maxw);margin:18px auto;padding:18px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:52px;height:52px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#0666d0);color:#fff;display:grid;place-items:center;font-weight:700}
  h1{margin:0;font-size:18px}
  p.lead{margin:0;color:var(--muted);font-size:13px}

  .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 8px 26px rgba(11,118,239,0.06);margin-top:14px}
  .grid{display:grid;grid-template-columns:320px 1fr;gap:14px}
  @media (max-width:960px){ .grid{grid-template-columns:1fr} }

  label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
  input[type="text"], input[type="url"], input[type="number"], select, textarea{
    width:100%;padding:10px;border-radius:8px;border:1px solid #e8eef8;font-size:14px;background:#fff;
  }
  textarea{min-height:70px;resize:vertical}
  button{cursor:pointer;padding:10px 12px;border-radius:10px;border:0;font-weight:700}
  .btn{background:var(--accent);color:white}
  .ghost{background:transparent;border:1px solid rgba(11,118,239,0.12);color:var(--accent)}
  .muted{color:var(--muted);font-size:13px}
  .small{font-size:13px;color:var(--muted)}
  .list{max-height:420px;overflow:auto;margin-top:8px;border-radius:8px;border:1px solid #eef4fb;padding:8px}

  /* PREVIEW (templates) */
  .previewWrap{background:#fff;padding:18px;border-radius:10px;box-shadow:0 4px 16px rgba(11,118,239,0.04)}
  .catalog{
    width:210mm; /* for A4 width guidance in px at 96dpi ~ 794px but css uses mm for print friendliness */
    margin:0 auto;
    padding:18px;
    background:white;
  }
  .catalog .header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px}
  .catalog .title{font-family:var(--font-serif);font-size:28px;color:#0b1220}
  .catalog .subtitle{font-size:13px;color:var(--muted)}

  /* Template: Moderna */
  .tpl-moderna .grid-items{display:grid;grid-template-columns:repeat(2,1fr);gap:14px}
  .tpl-moderna .card-prod{display:flex;gap:12px;background:#fafcff;border-radius:10px;padding:12px;align-items:center}
  .tpl-moderna .card-prod img{width:140px;height:100px;object-fit:cover;border-radius:8px}
  .tpl-moderna .prod-info h3{margin:0;font-size:16px;font-weight:700}
  .tpl-moderna .prod-info p{margin:6px 0 0;color:var(--muted);font-size:13px}
  .tpl-moderna .price{font-weight:700;color:var(--accent);margin-top:6px}

  /* Template: Elegante (big imagery) */
  .tpl-elegante .grid-items{display:grid;grid-template-columns:repeat(1,1fr);gap:18px}
  .tpl-elegante .card-prod{position:relative;border-radius:12px;overflow:hidden}
  .tpl-elegante .card-prod img{width:100%;height:240px;object-fit:cover;display:block}
  .tpl-elegante .overlay{position:absolute;left:18px;bottom:18px;color:white;text-shadow:0 6px 16px rgba(0,0,0,0.4)}
  .tpl-elegante .overlay h3{font-family:var(--font-serif);font-size:22px;margin:0}
  .tpl-elegante .overlay .price{font-weight:700;margin-top:6px}

  /* Template: Minimal (grid cards) */
  .tpl-minimal .grid-items{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  .tpl-minimal .card-prod{border-radius:10px;padding:12px;border:1px solid #f2f6fb;text-align:center}
  .tpl-minimal .card-prod img{width:100%;height:120px;object-fit:cover;border-radius:8px}
  .tpl-minimal .card-prod h3{margin:8px 0 6px;font-size:15px}
  .tpl-minimal .card-prod p{font-size:13px;color:var(--muted);min-height:36px}

  /* PDF note */
  .pdf-note{font-size:12px;color:var(--muted);margin-top:8px}
  /* small helper */
  .meta-row{display:flex;justify-content:space-between;gap:8px;align-items:center}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">C</div>
        <div>
          <h1>Generador de Cat√°logo ‚Äî Exportar PDF</h1>
          <p class="lead">Crea cat√°logos profesionales en segundos. Exporta PDF de alta calidad para imprimir o compartir.</p>
        </div>
      </div>

      <div class="controls">
        <select id="templateSelect" class="small">
          <option value="moderna">Moderna ‚Äî tarjetas con imagen derecha</option>
          <option value="elegante">Elegante ‚Äî im√°genes grandes y overlay</option>
          <option value="minimal">Minimal ‚Äî grid limpio</option>
        </select>
        <select id="orient" class="small">
          <option value="portrait">A4 ‚Äî Vertical</option>
          <option value="landscape">A4 ‚Äî Horizontal</option>
        </select>
        <button class="btn" id="btnExportPdf">Exportar PDF</button>
        <button class="ghost" id="btnClear">Limpiar</button>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: editor -->
      <aside>
        <div class="card">
          <strong>Informaci√≥n del cat√°logo</strong>
          <div style="margin-top:8px">
            <label>T√≠tulo del cat√°logo</label>
            <input id="catalogTitle" type="text" placeholder="Cat√°logo Primavera ¬∑ 2026" value="Cat√°logo de Productos"/>
            <label style="margin-top:8px">Subt√≠tulo / Nota</label>
            <input id="catalogSubtitle" type="text" placeholder="Mejores ofertas" value="Selecci√≥n destacada de la temporada" />
            <label style="margin-top:8px">Marca / Footer</label>
            <input id="catalogBrand" type="text" placeholder="Tu marca S.A." value="MiNegocio S.A." />
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <strong>Agregar producto / servicio</strong>
          <div style="margin-top:8px">
            <label>Imagen (URL)</label>
            <input id="prodImg" type="url" placeholder="https://...jpg" />
            <label style="margin-top:8px">Nombre</label>
            <input id="prodName" type="text" placeholder="Nombre del producto" />
            <label style="margin-top:8px">Precio</label>
            <input id="prodPrice" type="text" placeholder="S/ 49.90" />
            <label style="margin-top:8px">Descripci√≥n corta</label>
            <textarea id="prodDesc" placeholder="Descripci√≥n breve..."></textarea>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="btn" id="btnAddProd">Agregar</button>
              <button class="ghost" id="btnAddSample">Cargar muestra</button>
            </div>
            <div class="pdf-note">Usa im√°genes grandes y de alta resoluci√≥n para mejor calidad en el PDF.</div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <strong>Productos a√±adidos</strong>
          <div class="list" id="productsList"></div>
        </div>
      </aside>

      <!-- RIGHT: preview -->
      <main>
        <div class="card previewWrap">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="small">Vista previa</div>
              <div class="meta-row" style="margin-top:6px">
                <div style="font-weight:700" id="pvTitle">Cat√°logo de Productos</div>
                <div class="small" id="pvBrand">MiNegocio S.A.</div>
              </div>
            </div>
            <div class="small muted">Plantilla: <span id="pvTpl">Moderna</span></div>
          </div>

          <div style="margin-top:12px" id="previewArea">
            <!-- Catalog content injected here -->
          </div>

          <div class="pdf-note">Consejo: para calidad tipo "Canva", usa im√°genes ‚â•1200px, fuente serif para t√≠tulos y revisa m√°rgenes antes de exportar.</div>
        </div>
      </main>
    </div>
  </div>

  <!-- html2pdf library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <script>
    /* ======= Generador de Cat√°logo (client-side) ======= */
    const products = [];
    const sampleImgs = [
      'https://images.unsplash.com/photo-1606813903304-1c6e2e8b5a3b?w=1600&q=80&auto=format&fit=crop',
      'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=1600&q=80&auto=format&fit=crop',
      'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=1600&q=80&auto=format&fit=crop',
      'https://images.unsplash.com/photo-1543168256-4188115761b2?w=1600&q=80&auto=format&fit=crop'
    ];

    // DOM
    const tplSelect = document.getElementById('templateSelect');
    const previewArea = document.getElementById('previewArea');
    const productsList = document.getElementById('productsList');
    const pvTitle = document.getElementById('pvTitle');
    const pvBrand = document.getElementById('pvBrand');
    const pvTpl = document.getElementById('pvTpl');

    // form inputs
    const inpImg = document.getElementById('prodImg');
    const inpName = document.getElementById('prodName');
    const inpPrice = document.getElementById('prodPrice');
    const inpDesc = document.getElementById('prodDesc');

    document.getElementById('btnAddProd').addEventListener('click', ()=>{
      const img = inpImg.value.trim();
      const name = inpName.value.trim();
      const price = inpPrice.value.trim();
      const desc = inpDesc.value.trim();
      if(!name){ alert('Ingresa nombre del producto'); return; }
      products.unshift({ id: Date.now().toString(36), img: img || sampleImgs[Math.floor(Math.random()*sampleImgs.length)], name, price, desc });
      inpImg.value=''; inpName.value=''; inpPrice.value=''; inpDesc.value='';
      renderProductsList();
      renderPreview();
    });

    document.getElementById('btnAddSample').addEventListener('click', ()=>{
      // add 6 sample items
      const samples = [
        {name:'Pack Ahorro - 3 unidades', price:'S/ 49.90', desc:'Paquete promocional con 3 art√≠culos seleccionados.'},
        {name:'Camiseta Premium', price:'S/ 79.00', desc:'Algod√≥n pima, ajuste moderno.'},
        {name:'Curso Online: Marketing', price:'S/ 199.00', desc:'Acceso 3 meses + material descargable.'},
        {name:'Set Cocina Pro', price:'S/ 129.00', desc:'Incluye 5 piezas de acero inoxidable.'},
        {name:'Taza Edici√≥n Especial', price:'S/ 29.90', desc:'Dise√±o exclusivo de la temporada.'},
        {name:'Servicio: Instalaci√≥n', price:'S/ 79.00', desc:'Visita t√©cnica y puesta en marcha.'}
      ];
      samples.forEach(s => products.unshift({ id: Date.now().toString(36)+Math.random().toString(36).slice(2,6), img: sampleImgs[Math.floor(Math.random()*sampleImgs.length)], name:s.name, price:s.price, desc:s.desc }));
      renderProductsList(); renderPreview();
    });

    function renderProductsList(){
      if(products.length===0){ productsList.innerHTML = '<div class="small muted">No hay productos. A√±ade uno para ver la vista previa.</div>'; return; }
      let html='';
      products.forEach(p=>{
        html += `<div style="display:flex;gap:8px;align-items:center;padding:8px;border-bottom:1px dashed #f2f6fb">
          <img src="${p.img}" style="width:64px;height:48px;object-fit:cover;border-radius:6px" />
          <div style="flex:1">
            <div style="font-weight:700">${p.name}</div>
            <div class="small muted">${p.price || ''}</div>
          </div>
          <div style="display:flex;gap:6px">
            <button class="ghost" onclick="moveUp('${p.id}')">‚Üë</button>
            <button class="ghost" onclick="moveDown('${p.id}')">‚Üì</button>
            <button class="ghost" onclick="editProd('${p.id}')">‚úé</button>
            <button class="ghost" onclick="deleteProd('${p.id}')">üóë</button>
          </div>
        </div>`;
      });
      productsList.innerHTML = html;
    }

    window.moveUp = id => {
      const i = products.findIndex(p=>p.id===id); if(i>0){ products.splice(i-1,0,products.splice(i,1)[0]); renderProductsList(); renderPreview(); }
    };
    window.moveDown = id => {
      const i = products.findIndex(p=>p.id===id); if(i>=0 && i<products.length-1){ products.splice(i+1,0,products.splice(i,1)[0]); renderProductsList(); renderPreview(); }
    };
    window.editProd = id => {
      const p = products.find(x=>x.id===id); if(!p) return;
      const name = prompt('Editar nombre', p.name); if(name===null) return;
      const price = prompt('Editar precio', p.price||''); if(price===null) return;
      const desc = prompt('Editar descripci√≥n', p.desc||''); if(desc===null) return;
      p.name = name; p.price = price; p.desc = desc;
      renderProductsList(); renderPreview();
    };
    window.deleteProd = id => { if(confirm('Eliminar producto?')){ const i = products.findIndex(p=>p.id===id); if(i>=0) products.splice(i,1); renderProductsList(); renderPreview(); } };

    tplSelect.addEventListener('change', renderPreview);
    document.getElementById('catalogTitle').addEventListener('input', renderPreview);
    document.getElementById('catalogSubtitle').addEventListener('input', renderPreview);
    document.getElementById('catalogBrand').addEventListener('input', renderPreview);

    function renderPreview(){
      const tpl = tplSelect.value;
      pvTpl.textContent = tpl.charAt(0).toUpperCase() + tpl.slice(1);
      pvTitle.textContent = document.getElementById('catalogTitle').value || 'Cat√°logo';
      pvBrand.textContent = document.getElementById('catalogBrand').value || '';
      // Build HTML
      let html = `<div class="catalog tpl-${tpl}" id="catalogRoot">`;
      html += `<div class="header"><div><div class="title">${escapeHtml(document.getElementById('catalogTitle').value||'Cat√°logo')}</div><div class="subtitle">${escapeHtml(document.getElementById('catalogSubtitle').value||'')}</div></div><div class="small">${escapeHtml(document.getElementById('catalogBrand').value||'')}</div></div>`;
      html += `<div class="grid-items">`;
      if(products.length===0){
        html += `<div style="padding:40px;text-align:center;color:#9aa6b2">No hay productos. Agrega productos para ver la vista previa.</div>`;
      } else {
        if(tpl === 'moderna'){
          products.forEach(p=>{
            html += `<div class="card-prod">
              <img src="${p.img}" alt="${escapeHtml(p.name)}" />
              <div class="prod-info">
                <h3>${escapeHtml(p.name)}</h3>
                <p>${escapeHtml(p.desc||'')}</p>
                <div class="price">${escapeHtml(p.price||'')}</div>
              </div>
            </div>`;
          });
        } else if(tpl === 'elegante'){
          products.forEach(p=>{
            html += `<div class="card-prod">
              <img src="${p.img}" alt="${escapeHtml(p.name)}" />
              <div class="overlay">
                <h3>${escapeHtml(p.name)}</h3>
                <div class="price">${escapeHtml(p.price||'')}</div>
                <div style="font-size:12px;margin-top:6px;max-width:60%">${escapeHtml(p.desc||'')}</div>
              </div>
            </div>`;
          });
        } else { // minimal
          products.forEach(p=>{
            html += `<div class="card-prod">
              <img src="${p.img}" alt="${escapeHtml(p.name)}" />
              <h3>${escapeHtml(p.name)}</h3>
              <p>${escapeHtml(p.desc||'')}</p>
              <div class="price">${escapeHtml(p.price||'')}</div>
            </div>`;
          });
        }
      }
      html += `</div></div>`; // grid-items + catalog
      previewArea.innerHTML = html;
      // Preload images for crisper PDF (attempt)
      document.querySelectorAll('#previewArea img').forEach(img=>{
        img.setAttribute('crossorigin','anonymous');
      });
    }

    function escapeHtml(s){ if(!s && s!==0) return ''; return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    // initial render
    renderPreview();

    // clear
    document.getElementById('btnClear').addEventListener('click', ()=> {
      if(!confirm('Limpiar todo (productos y campos)?')) return;
      products.length = 0;
      document.getElementById('catalogTitle').value = 'Cat√°logo de Productos';
      document.getElementById('catalogSubtitle').value = 'Selecci√≥n destacada de la temporada';
      document.getElementById('catalogBrand').value = 'MiNegocio S.A.';
      renderProductsList(); renderPreview();
    });

    /* ===== EXPORT PDF =====
      Using html2pdf (wrapper over html2canvas + jsPDF).
      We'll set high quality options: image type jpeg quality 0.98, html2canvas scale 2 (or 3 for very high).
      For A4 we use 'a4' with orientation from select. Margin flexible.
    */
    document.getElementById('btnExportPdf').addEventListener('click', async ()=>{
      const catalogRoot = document.getElementById('catalogRoot');
      if(!catalogRoot){ alert('No hay contenido para exportar.'); return; }
      // force re-render to ensure images have crossorigin attr
      renderPreview();

      const orientation = document.getElementById('orient').value === 'landscape' ? 'landscape' : 'portrait';
      // Options tuning: increase scale for better vector-like crispness. Beware of memory/time if too high.
      const opt = {
        margin: [10,10,10,10],
        filename: (document.getElementById('catalogTitle').value || 'catalogo').replace(/\s+/g,'_').toLowerCase() + '.pdf',
        image: { type: 'jpeg', quality: 0.96 },
        html2canvas: { scale: 2, useCORS: true, logging: false, allowTaint: false },
        jsPDF: { unit: 'mm', format: 'a4', orientation: orientation }
      };

      // Before export: show a friendly message for large exports
      const approxItems = products.length;
      if(approxItems > 30 && !confirm('Est√°s exportando muchos productos (m√°s de 30). El PDF puede tardar o consumir memoria. ¬øContinuar?')) return;

      // Wrap with a promise to wait for images to load
      await ensureImagesLoaded(document.querySelectorAll('#previewArea img'));

      // Use html2pdf
      try{
        // Create a temporary element cloned to better control width for pdf (avoid site chrome)
        const clone = catalogRoot.cloneNode(true);
        // Force A4 width in px for html2canvas to render consistent size. Using 210mm at 96dpi ~ 794px; but retina scale handled by html2canvas.scale
        clone.style.width = orientation === 'landscape' ? '297mm' : '210mm';
        clone.style.boxSizing = 'border-box';
        const wrapper = document.createElement('div');
        wrapper.style.background = '#ffffff';
        wrapper.appendChild(clone);
        document.body.appendChild(wrapper);

        await html2pdf().set(opt).from(clone).save();
        // cleanup
        document.body.removeChild(wrapper);
      }catch(err){
        console.error(err);
        alert('Error al generar PDF. Prueba reducir la cantidad de im√°genes o usar menor escala (scale en opciones).');
      }
    });

    // ensure images loaded (returns a Promise)
    function ensureImagesLoaded(imgs){
      const arr = Array.from(imgs || []);
      return Promise.all(arr.map(img=>{
        return new Promise(resolve=>{
          if(!img.src) return resolve();
          if(img.complete) return resolve();
          img.onload = img.onerror = ()=> resolve();
        });
      }));
    }

    // small UX: allow dragging images? skip for simplicity
    // end of script
  </script>
</body>
</html>
